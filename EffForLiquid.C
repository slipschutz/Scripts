
#include <vector>
#include <utility>

//Eff2 is for taking the points from a histogram instead of a tree

void EffForLiquid(TH1F* hN){

  Double_t x[71]={0.0075000,
		  0.0250000,
		  0.0450000,
		  0.0650000,
		  0.0850000,
		  0.1050000,
		  0.1250000,
		  0.1500000,
		  0.1800000,
		  0.2100000,
		  0.2400000,
		  0.2800000,
		  0.3300000,
		  0.3800000,
		  0.4300000,
		  0.4800000,
		  0.5300000,
		  0.5800000,
		  0.6300000,
		  0.6800000,
		  0.7300000,
		  0.7800000,
		  0.8300000,
		  0.8800000,
		  0.9300000,
		  1.0025000,
		  1.1000000,
		  1.2000000,
		  1.3000000,
		  1.4000000,
		  1.5000000,
		  1.6000000,
		  1.7000000,
		  1.8000000,
		  1.9000000,
		  2.0500000,
		  2.2500000,
		  2.4500000,
		  2.6500000,
		  2.8500000,
		  3.1000000,
		  3.4000000,
		  3.7000000,
		  4.0000000,
		  4.3000000,
		  4.6000000,
		  4.9000000,
		  5.3000000,
		  5.8000000,
		  6.3000000,
		  6.8000000,
		  7.3000000,
		  7.8000000,
		  8.3000000,
		  8.8000000,
		  9.3000000,
		  9.8000000,
		  10.3000000,
		  10.8000000,
		  11.3000000,
		  11.8000000,
		  12.3000000,
		  12.8000000,
		  13.3000000,
		  13.8000000,
		  14.3250000,
		  15.2500000,
		  16.4000000,
		  17.4000000,
		  18.5000000,
		  19.5500000};
  Double_t ex[71] = {0.0075000,
		     0.0100000,
		     0.0100000,
		     0.0100000,
		     0.0100000,
		     0.0100000,
		     0.0100000,
		     0.0150000,
		     0.0150000,
		     0.0150000,
		     0.0150000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0250000,
		     0.0475000,
		     0.0500000,
		     0.0500000,
		     0.0500000,
		     0.0500000,
		     0.0500000,
		     0.0500000,
		     0.0500000,
		     0.0500000,
		     0.0500000,
		     0.1000000,
		     0.1000000,
		     0.1000000,
		     0.1000000,
		     0.1000000,
		     0.1500000,
		     0.1500000,
		     0.1500000,
		     0.1500000,
		     0.1500000,
		     0.1500000,
		     0.1500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2500000,
		     0.2750000,
		     0.6500000,
		     0.5000000,
		     0.5000000,
		     0.6000000,
		     0.4500000};
  Double_t y[71] ={5.1405333e-02,
		   9.8349500e-02,
		   1.3175000e-01,
		   1.5643750e-01,
		   1.7663350e-01,
		   1.9363550e-01,
		   2.0850400e-01,
		   2.2458900e-01,
		   2.4100000e-01,
		   2.5523733e-01,
		   2.6748400e-01,
		   2.8124000e-01,
		   2.9507200e-01,
		   3.0641600e-01,
		   3.1503400e-01,
		   3.2242800e-01,
		   3.2723000e-01,
		   3.3126800e-01,
		   3.3392000e-01,
		   3.3561000e-01,
		   3.3608000e-01,
		   3.3571400e-01,
		   3.3533800e-01,
		   3.3394000e-01,
		   3.3184000e-01,
		   3.2844632e-01,
		   3.2205000e-01,
		   3.1490200e-01,
		   3.0596700e-01,
		   2.9673300e-01,
		   2.8734700e-01,
		   2.7704000e-01,
		   2.6658000e-01,
		   2.5612000e-01,
		   2.4566000e-01,
		   2.3020050e-01,
		   2.1007500e-01,
		   1.9050950e-01,
		   1.7230650e-01,
		   1.5540000e-01,
		   1.3587233e-01,
		   1.1480600e-01,
		   9.6560667e-02,
		   8.0777667e-02,
		   6.7334333e-02,
		   5.5928667e-02,
		   4.6381333e-02,
		   3.6111800e-02,
		   2.6234400e-02,
		   1.8971620e-02,
		   1.3666760e-02,
		   9.8124400e-03,
		   7.0360200e-03,
		   5.0407600e-03,
		   3.6132800e-03,
		   2.5885200e-03,
		   1.8538120e-03,
		   1.3248120e-03,
		   9.4736800e-04,
		   6.7701400e-04,
		   4.8375800e-04,
		   3.4512600e-04,
		   2.4605200e-04,
		   1.7495000e-04,
		   1.2437880e-04,
		   8.6900727e-05,
		   4.8199615e-05,
		   2.1518400e-05,
		   1.0859600e-05,
		   5.0966000e-06,
		   2.4220667e-06};
  double spacing = 0.05; //for liquid scint eff
       
  double ValuesForLiqEff[200]={0,
			       0.00000,
			       0.00000,
			       0.00000,
			       0.00246,
			       0.01881,
			       0.05799,
			       0.12106,
			       0.20209,
			       0.26270,
			       0.32173,
			       0.37503,
			       0.39336,
			       0.43267,
			       0.44409,
			       0.44951,
			       0.45168,
			       0.46246,
			       0.47615,
			       0.46936,
			       0.46863,
			       0.46137,
			       0.47597,
			       0.46848,
			       0.45880,
			       0.45533,
			       0.45178,
			       0.46308,
			       0.46558,
			       0.45243,
			       0.45156,
			       0.43683,
			       0.43974,
			       0.43328,
			       0.43344,
			       0.43239,
			       0.42698,
			       0.42637,
			       0.43325,
			       0.41206,
			       0.41145,
			       0.41686,
			       0.41145,
			       0.41377,
			       0.41629,
			       0.40796,
			       0.40178,
			       0.40542,
			       0.40564,
			       0.39473,
			       0.39071,
			       0.39646,
			       0.38765,
			       0.38911,
			       0.38262,
			       0.38697,
			       0.37326,
			       0.36638,
			       0.36675,
			       0.36181,
			       0.37273,
			       0.37285,
			       0.37551,
			       0.36509,
			       0.36767,
			       0.36071,
			       0.35176,
			       0.34378,
			       0.34049,
			       0.34917,
			       0.33636,
			       0.33699,
			       0.33724,
			       0.32808,
			       0.31807,
			       0.31678,
			       0.30910,
			       0.30753,
			       0.30426,
			       0.29120,
			       0.27882,
			       0.28674,
			       0.27348,
			       0.27201,
			       0.26526,
			       0.27265,
			       0.26245,
			       0.26216,
			       0.25756,
			       0.25412,
			       0.24076,
			       0.24177,
			       0.24512,
			       0.23436,
			       0.23533,
			       0.23933,
			       0.22938,
			       0.22574,
			       0.22209,
			       0.21728,
			       0.21821,
			       0.22091,
			       0.21832,
			       0.21520,
			       0.20904,
			       0.20649,
			       0.20405,
			       0.20287,
			       0.20405,
			       0.19467,
			       0.19868,
			       0.19734,
			       0.18380,
			       0.18881,
			       0.19067,
			       0.18682,
			       0.18320,
			       0.18497,
			       0.18563,
			       0.17975,
			       0.18259,
			       0.17822,
			       0.17524,
			       0.17106,
			       0.17244,
			       0.17989,
			       0.16692,
			       0.16577,
			       0.17014,
			       0.16088,
			       0.16717,
			       0.15956,
			       0.15581,
			       0.15556,
			       0.15266,
			       0.15875,
			       0.15017,
			       0.15535,
			       0.15179,
			       0.14323,
			       0.14689,
			       0.14798,
			       0.14972,
			       0.14388,
			       0.13855,
			       0.14270,
			       0.13865,
			       0.14064,
			       0.13699,
			       0.14224,
			       0.13648,
			       0.13648,
			       0.14061,
			       0.13478,
			       0.14065,
			       0.14049,
			       0.14089,
			       0.14226,
			       0.14534,
			       0.14308,
			       0.14091,
			       0.14091,
			       0.14225,
			       0.13337,
			       0.12800,
			       0.12900,
			       0.12584,
			       0.12474,
			       0.12210,
			       0.12889,
			       0.12340,
			       0.12452,
			       0.11610,
			       0.12338,
			       0.12199,
			       0.12830,
			       0.12289,
			       0.12307,
			       0.12931,
			       0.13140,
			       0.13089,
			       0.13341,
			       0.13639,
			       0.13484,
			       0.13957,
			       0.13733,
			       0.13376,
			       0.13849,
			       0.13485,
			       0.12888,
			       0.12647,
			       0.12426,
			       0.12177,
			       0.12603,
			       0.12675,
			       0.12180,
			       0.11609,
			       0.11853,
			       0.11290};  

  TH1F * effOfLiqScint = new TH1F("effOfLiqScint","",200,0,10);
  for (int i=0;i<200;i++){
    effOfLiqScint->SetBinContent(i+1,ValuesForLiqEff[i]);
  }
  
  effOfLiqScint->Draw();

    
  Float_t bins[71];

  bins[0]=x[0]-ex[0];//first bin is left side of bin
  for (int i=1;i<70;i++){
    bins[i] = x[i]-ex[i];
  }
  bins[70]=x[70]+ex[70];//last bin to the right side of last bin

  
  TH1F * Yield=new TH1F("Yield","",70,bins);
  TH1F * eff=new TH1F("eff","",70,bins);
  TH1D * N=new TH1D("N","",70,bins);
  TH1D * N2=new TH1D("N2","",200,0,20);
  for(int i=0;i<71;i++){
    //    cout<<h->GetBinLowEdge(i+1)<<" "<<h->GetBinWidth(i+1)+h->GetBinLowEdge(i+1)<<endl;
    Yield->SetBinContent(i+1,y[i]);
    eff->SetBinContent(i+1,0);
    N->SetBinContent(i+1,0);
  }
  
  

  Int_t numEntries = hN->GetNbinsX();
  
  cout<<"NNNNNN "<<numEntries<<endl;

  Double_t time=0;

  Double_t c= 2.99 * TMath::Power(10,8);

  for (int i=1;i<=numEntries;i++){
    
    time = hN->GetBinCenter(i);
    if (time >3){

      time = time *10*(1.0/(TMath::Power(10,9)));// put time in secs
      Double_t beta = (1.0/c)*(1.0/time);
      Double_t gamma = 1.0/(TMath::Sqrt(1-beta*beta));
      Double_t KE = (gamma-1)*939.5650; // MEV
      

      // cout<<"time is "<<time<<endl;
      //	    cout<<"Ke is "<<KE<<endl;
      
      //      int bin= N->GetXaxis()->FindBin((Double_t)KE);
      // N->SetBinContent(bin,);
      N->Fill((Double_t)KE);
    }
  }




  TH1F* test = new TH1F("test","",70,bins);
  for (int i=0;i<71;i++){
    cout<<"N is "<<N->GetBinContent(i+1)<<endl;
    cout<<"N center is "<<N->GetBinCenter(i+1)<<endl;
    cout<<"Bin For that N center "<<effOfLiqScint->FindBin(N->GetBinCenter(i+1))<<endl;
    cout<<"value for efficiency "<<effOfLiqScint->GetBinContent(effOfLiqScint->FindBin(N->GetBinCenter(i+1)))<<endl;
    cout<<"I IS "<<i<<endl;
    eff->SetBinContent(i+1,(Double_t(N->GetBinContent(i+1)))/(effOfLiqScint->GetBinContent(effOfLiqScint->FindBin(N->GetBinCenter(i+1)))));
    
    test->SetBinContent(i+1,Yield->GetBinContent(i+1)*effOfLiqScint->GetBinContent(effOfLiqScint->FindBin(Yield->GetBinCenter(i+1))));

    //    cout<<(Double_t(N->GetBinContent(i+1)))<<" over "<<(effOfLiqScint->GetBinContent(effOfLiqScint->FindBin(N->GetBinCenter(i+1)))));
  }

  TCanvas * cC = new TCanvas("c");
  cC->cd(1);
  eff->Draw();

  TFile f("EffLiqout.root","recreate");

  effOfLiqScint->Write();
  eff->Write();
  N->Write();
  test->Write();
  Yield->Write();
  f.Close();

}
